<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实验中</title>
    {#    TODO: use local <jquery></jquery>#}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    {#    {% load static %}#}
    {#    <script src="{% static 'rps/jquery.min.js' %}"></script>#}
</head>
<body>
<div>
    <h2>ID: {{ id }}</h2>
</div>

实验界面
<div class="history">
    历史对战记录
    {% if history_list %}
        <table border="1">
            <tr>
                <th>轮数</th>
                <th>你的策略</th>
                <th>对手的策略</th>
                {#                <th>胜负情况</th>#}
                {#                <th>得分</th>#}
            </tr>
            {% for history in history_list %}
                <tr>
                    <th>{{ history.count }}</th>
                    <th>{{ history.user_action }}</th>
                    <th>{{ history.competitor_action }}</th>
                    {#                    <th>{{ history.win }}</th>#}
                    {#                    <th>{{ history.points }}</th>#}
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No history are available.</p>
    {% endif %}
</div>

<div id="next">
    <form method="post" action="/handon/" id="submit">
        {% csrf_token %}
        <label>策略:</label>
        <ul>
            <li>
                <label>R: 石头</label>
                <input type="radio" value="0" id="rock" name="action"/>
            </li>
            <li>
                <label>P: 布</label>
                <input type="radio" value="1" id="paper" name="action"/>
            </li>
            <li><label>S: 剪刀 </label>
                <input type="radio" value="2" id="scissors" name="action"/>
            </li>
        </ul>
        <input type="hidden" id="id" name="id" value="{{ id }}">
    </form>
    <button id="submit_button">提交</button>

</div>

</body>

{% csrf_token %}
<script language="JavaScript">
    document.getElementById('submit_button').onclick = function () {

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        var r = document.getElementById("rock").checked;
        var p = document.getElementById("paper").checked;
        var s = document.getElementById("scissors").checked;
        alert("click");
        if (!(r || p || s)) {
            alert("请输入你的决策");
        } else {
            // document.getElementById("submit").submit();
            // send ajax
            $.ajax({
                type: 'post',
                url: '/play/',
                data: {
                    id: {{ id }},
                    action_r: r,
                    action_p: p,
                    action_s: s
                },
                success: function (json) {
                    alert("return success " + json['info'])
                }
            });
        }

    }

</script>

</html>